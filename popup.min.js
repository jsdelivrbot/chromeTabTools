(function(){var f,e,n,o,s,l,t,i,r,h,c,u;n={code:"tabTools",dcTabs:[],ccTabs:[],bkTT:"",bkTree:{},dt:{},T:{}};Array.prototype.toDict=function(n){var r,t,i,u;for(r={},i=0,u=this.length;i<u;i++)t=this[i],t[n]!=null&&(r[t[n]]=t);return r};i=function(n,t,r,u){if(n!=null&&(u(n,t),r(n)!=null))return i(r(n),n,r,u)};u=function(n,t,i,r){$.each(n,function(n,f){if(f!=null&&(r(f,t),i(f)!=null))return u(i(f),f,i,r)})};t=function(){return chrome.bookmarks.search(n.code,function(t){return t.length>=1&&(n.bkTT=t[0].id),chrome.bookmarks.getTree(function(t){var r;n.bkTree=[t[0]];r={};u(n.bkTree,null,function(n){return n.children},function(t,u){var s,e,f,o;(t.parentNode=u,o=function(){var i,e,r,u;for(r=n.dcTabs.concat(n.ccTabs),u=[],i=0,e=r.length;i<e;i++)f=r[i],f.url===t.url&&u.push(f);return u}(),o.length!==0)&&(f=o[0],r[f]!=null?r[f].push(t):r[f]=[t],s='<a class="fStar">&#9733<\/a>',e="",i(u.parentNode,u,function(n){return n.parentNode},function(n,t){if(t)return e=t.title+"/ "+e}),$("#wS"+f.id)[0].outerHTML=s.replace("<a",'<a id="wS'+f.id+'" title="'+e+'" target="_blank" href="chrome://bookmarks/#'+u.id+'"'))});localStorage.recentCards?n.recentCards=JSON.parse(localStorage.recentCards):n.dt.recentCards=[];$(window).on("message",function(n){var i,t;return i=n.originalEvent.data,t=localStorage.recentCards?JSON.parse(localStorage.recentCards):[],t=$.grep(t,function(n){return n.id!==i.id}),t.splice(0,0,i),localStorage.recentCards=JSON.stringify(t)});if(typeof Trello!="undefined"&&Trello!==null)return Trello.get("members/me?fields=fullName&boards=starred&board_fields=name,prefs,dateLastView,starred",function(t){var r,u,i;t.boards=t.boards.sort(function(n,t){return new Date(t.dateLastView)-new Date(n.dateLastView)});t.boards=t.boards.toDict("id");n.dt=t;n.dt.recentCards=n.recentCards;n.dt.cards=[];$("#fullName").text(t.fullName);i=n.dt.boards;for(u in i)r=i[u],Trello.get("board/"+r.id+"?fields=name&lists=open&list_fields=name&cards=open&card_fields=name,desc,idList,pos",function(t){var r,i,f,u;for(t.lists=t.lists.toDict("id"),u=t.cards,i=0,f=u.length;i<f;i++)r=u[i],r.descHTML=(new showdown.Converter).makeHtml(r.desc);return n.dt.boards[t.id].lists=t.lists,n.dt.boards[t.id].cards=t.cards,$("#sandbox")[0].contentWindow.postMessage(n.dt.boards[t.id],"*")});$("#sandbox")[0].contentWindow.postMessage(n.dt,"*")})})})};$(document).ready(function(){return $(document).click(function(n){if(n.which!==3)return n.preventDefault(),!1})});h=function(n){return n.audible?"/static/clock.png":n.favIconUrl&&(n.favIconUrl.match("^data:")||/^https?:\/\/.*/.exec(n.favIconUrl))?n.favIconUrl:/^chrome:\/\/extensions\/.*/.exec(n.url)?"/static/clock.png":"/static/clock.png"};r=function(n){if(n.target===this)return n.which===2?(n.preventDefault(),n.stopPropagation(),n.target.remove(),chrome.tabs.get(+$(this).attr("id"),function(n){return chrome.tabs.remove(n.id)})):n.which===1?chrome.tabs.get(+$(this).attr("id"),function(n){return chrome.tabs.update(n.id,{active:!0})}):void 0};e=function(){if(chrome.tabs!=null)return chrome.tabs.getAllInWindow(function(t){var s,e,c,u,i,v,l,y,f,a,o;for(c=[],v=function(){var n,u,r;for(r=[],n=0,u=t.length;n<u;n++)i=t[n],r.push(i.title+" "+i.url);return r}().join(" "),s='<div class="cross">&#x2716<\/div>',y='<div class="wStar">&#9734<\/div>',l='<div class="wStar"><\/div>',o=t.sort(function(n,t){return t.index-n.index}),f=0,a=o.length;f<a;f++)i=o[f],e=i.discarded?"d":"c",u='<img src="'+h(i)+'" width=16 height=16 />',u.match("/clock.png")&&(u=""),$("#"+e+"cList").append('<div class="'+(i.highlighted?"hlTab ":"")+e+'cTab trim-text" id="'+i.id+'" title="'+i.title+"&#013("+i.url+')">'+l.replace("<div",'<div id="wS'+i.id+'" ')+u+i.title+s+"<\/div>"),i.discarded?(c.push({title:i.title,url:i.url}),n.dcTabs.push(i)):n.ccTabs.push(i);return $(".ccTab").mouseup(r),$("#dcList").children().length>0?($(".dcTab").mouseup(r),$("#dcHead").show()):$("#dcHead").hide(),$(".cross").mouseup(function(n){return chrome.tabs.get(+n.target.parentNode.getAttribute("id"),function(t){return chrome.tabs.remove(t.id),n.stopPropagation()}),n.target.parentNode.remove()})})};s=function(){if(typeof Trello=="undefined"||Trello===null){t();return}return Trello.authorize({type:chrome.extension!=null?"popX":"popup",name:"Tab Tool",key:"654f1af34d6fd053c6e2cc378993941f",scope:{read:"true",write:"true",account:"true"},token_html:"token.html",expiration:"never",success:o})};window.onload=function(){var n;if(window.location.href.indexOf("#token")!==-1)return n=window.location.href.split("#token="),Trello.setToken(n[1]),Trello.writeStorage("token",n[1])};o=function(){return $("#checkAuth").hide(),t()};c=function(){return $("#testBut").click(function(){})};f=["https://www.googleapis.com/auth/drive.file","https://www.googleapis.com/auth/drive.metadata.readonly","email","profile"];l=function(){return gapi.client.setApiKey(apiKey),gapi.auth.authorize({client_id:clientId,client_secret:"dPgjdzoSb--IhUlYIvI0KBYp",scope:f,immediate:!0},gapi.client.load("drive","v2",function(){var n;return n=gapi.client.drive.files.list(),n.execute(function(n){var r,t,i,u;if(!n.error){if(appendPre("Files:"),t=n.items,t&&t.length>0){for(i=0,u=[];i<t.length;)r=t[i],appendPre(r.title+" ("+r.id+")"),u.push(i++);return u}return appendPre("No files found.")}})}))};s();e();c()}).call(this);